---
import Layout from '../../../layouts/Layout.astro';
import PageHeader from '../../../components/page-header/page-header.astro';
import PageHeaderHeading from '../../../components/page-header/heading.astro';
import PageHeaderDescription from '../../../components/page-header/description.astro';
import VotesMetrics from '../../../components/vote-metrics/vote-metrics.astro';
import Separator from '../../../components/core/separator.astro';
import VotesTable from '../../../components/table/votes-table.astro';

import { GetProposalListResult, getProposal, getProposalList } from '../../../../common/store';

export const prerender = true;

export async function getStaticPaths() {
    const proposals: GetProposalListResult = await getProposalList();
    const ids: number[] = proposals.map(proposal => proposal.id.toString());
    return ids.map(id => {
        return { params: { id } };
    });
}

const id = Astro.params.id;

const proposal = await getProposal(id);

---
<Layout>
    <div class="container relative">
        <PageHeader className="hidden md:block pb-6">
            <PageHeaderHeading>{proposal.title}</PageHeaderHeading>
            <PageHeaderDescription>
                {proposal.description}
            </PageHeaderDescription>
        </PageHeader>
    
        <PageHeader className="block md:hidden pb-6 text-center">
            <PageHeaderHeading className="text-2xl">{proposal.title}</PageHeaderHeading>
            <PageHeaderDescription className="text-base">{proposal.description}</PageHeaderDescription>
        </PageHeader>

        <div class="flex flex-col gap-2">
            <VotesMetrics variant="default" proposal={proposal} />
            <Separator />
            <VotesTable votes={proposal.votes}/>
        </div>
    </div>
</Layout>

